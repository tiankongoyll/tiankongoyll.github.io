<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Seniverse API Test Page</title>
		<script type="text/javascript" src="js/jquary.js"></script>
		<script type="text/javascript" src="js/jm.js"></script>
	</head>

	<body>
		<div id="content"></div>
		<script>
			/******** 本示例仅做开发参考使用，不建议在生产环境下暴露 key！ ********/
			var UID = "U785B76FC9"; // 测试用 用户ID，请更换成您自己的用户ID
			var KEY = "4r9bergjetiv1tsd"; // 测试用key，请更换成您自己的 Key
			var API = "http://api.seniverse.com/v3/weather/daily.json"; // 获取天气实况
			var LOCATION = "shanghai"; // 除拼音外，还可以使用 v3 id、汉语等形式
			// 获取当前时间戳
			var ts = Math.floor((new Date()).getTime() / 1000);
			// 构造验证参数字符串
			var str = "ts=" + ts + "&uid=" + UID;
			// 使用 HMAC-SHA1 方式，以 API 密钥（key）对上一步生成的参数字符串（raw）进行加密
			// 并将加密结果用 base64 编码，并做一个 urlencode，得到签名 sig
			var sig = CryptoJS.HmacSHA1(str, KEY).toString(CryptoJS.enc.Base64);
			sig = encodeURIComponent(sig);
			str = str + "&sig=" + sig;
			// 构造最终请求的 url
			var url = API + "?location=" + LOCATION + "&" + str + "&callback=?";
			// 直接发送请求进行调用，手动处理回调函数
			$.getJSON(url, function(data) {
				var obj = document.getElementById('content');
				var weather = data.results[0];
				console.log(JSON.stringify(weather))
//				var text = [];
//				text.push("Location: " + weather.location.path);
//				text.push("Weather: " + weather.now.text);
//				text.push("Temperature: " + weather.now.temperature);
//				obj.innerText = text.join("\n")
			});
			
			
			
			var obj={
				    "location": {
				        "id": "WTW3SJ5ZBJUY", 
				        "name": "上海", 
				        "country": "CN", 
				        "path": "上海,上海,中国", 
				        "timezone": "Asia/Shanghai", 
				        "timezone_offset": "+08:00"
				    }, 
				    "now": {
				        "text": "多云", 
				        "code": "4", 
				        "temperature": "18", 
				        "feels_like": "18", 
				        "pressure": "1021", 
				        "humidity": "59", 
				        "visibility": "14.2", 
				        "wind_direction": "西", 
				        "wind_direction_degree": "282", 
				        "wind_speed": "3.6", 
				        "wind_scale": "1", 
				        "clouds": "54", 
				        "dew_point": ""
				    }, 
				    "last_update": "2017-11-15T13:19:00+08:00"
				}
		</script>
	</body>

</html>